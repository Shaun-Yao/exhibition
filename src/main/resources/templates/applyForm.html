<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>订货会智能会务系统</title>
    <script src="/webjars/jquery/3.1.1/jquery.min.js"></script>
    <script src="/webjars/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="/webjars/bootbox.js/5.1.3/dist/bootbox.min.js"></script>
    <link rel="stylesheet" href="/webjars/bootstrap/3.3.7/css/bootstrap.min.css" />
</head>
<body>
<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title">浪漫春天2020春夏发布会报名</h3>
    </div>
    <div class="panel-body">
        <form role="form" id="form" th:action="@{apply} + '?code=test'" method="post" enctype="multipart/form-data">
            <input type="hidden" name="id" th:value="${session.userId}"/>
            <input type="hidden" name="openId" th:value="${session.openId}"/>

            <div class="form-group">
               <label for="shopCode" class="col-sm-2 control-label">店铺代码</label>
               <input type="text" class="form-control" name="shopCode" id="shopCode" required="required"
                      th:value="${user == null ? 'D' : user.shopCode}" />
           </div>

            <div th:if="${user != null}">
                <a href="/participant/list">编辑人员信息</a>
                <ul class="list-group" th:each="participant : ${participants}">
                    <li class="list-group-item" th:text="${participant.name}"></li>
                </ul>

            </div>

            <p></p>
            <div class="col-md-4 text-center">
               <button type="button" th:if="${user == null}"
                       class="btn btn-primary btn-block" id="submitBtn">提交报名</button>
               <button type="button" th:if="${user != null}"
                       class="btn btn-warning btn-block" id="modifyBtn">修改店铺代码</button>
           </div>
       </form>
   </div>

</div>
    </body>
<script>
   function goBack() {
       window.location.href='/index';
   }


   $(function(){

       $('#submitBtn, #modifyBtn').click(function() {
           if($('#form')[0].reportValidity()) {
               $.ajax({
                   type: "GET",
                   url: "/shop/get",
                   data: {
                       "code": $("#shopCode").val()
                   },
                   //dataType: "json",
                   success: function(data){

                       if (data.length == 0) {
                           //bootbox.setDefaults("locale", "zh_CN");
                           bootbox.alert('找不到对应店铺，请确认店铺代码是否正确！');
                           /*bootbox.alert({
                               message: '找不到对应店铺，请确认店铺代码是否正确！',
                               buttons: {
                                   ok: {
                                       label: '确定'
                                   }
                               }
                           });*/
                       } else {
                           /*bootbox.confirm(data.name + " 确认报名？",
                               function(result){
                               if(result) {
                                   $(".panel-body").modal('show');
                                   $('#repairForm').submit();
                               }
                           });*/

                           bootbox.confirm({
                               message: data.code + "  " +  data.name + " 确认报名？",
                               buttons: {
                                   confirm: {
                                       label: '确认',
                                       className: 'btn-success'
                                   },
                                   cancel: {
                                       label: '取消',
                                       className: 'btn-danger'
                                   }
                               },
                               callback: function (result) {
                                   if(result) {
                                       $(".panel-body").modal('show');
                                       $('#form').submit();
                                   }
                               }
                           });
                       }
                   }
               });
           }

/*

           if($('#repairForm')[0].reportValidity()) {
               //event.preventDefault();
               bootbox.confirm("确认提交维修申请？", function(result){
                   if(result) {
                       $(".panel-body").modal('show');
                       $('#repairForm').submit();
                   }
               });
           }
*/

       })

   });

</script>
</html>